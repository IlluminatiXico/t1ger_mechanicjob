--[[


     â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ•â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•—
     â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â•šâ–ˆâ–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
â–ˆâ–ˆ   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•   â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â•šâ•â•â•â–ˆâ–ˆâ•—â•šâ•â•â•â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• 
â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•     â•šâ•â•  â•šâ•â• â•šâ•â• â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â• â•šâ•â•â•šâ•â•â•â•â•â•â•
                                                                                                 

 ]]

 RSCore=nil;player=nil;coords={}curVehicle=nil;driver=nil;jerico=0;Citizen.CreateThread(function()while RSCore==nil do TriggerEvent("RSCore:GetObject",function(a)RSCore=a end)Citizen.Wait(1)end;while true do player=PlayerPedId()coords=GetEntityCoords(player)curVehicle=GetVehiclePedIsIn(player,false)driver=GetPedInVehicleSeat(curVehicle,-1)Citizen.Wait(100)end end)plyShopID=0;emptyShops={}RegisterNetEvent('RSCore:Client:OnPlayerLoaded')AddEventHandler('RSCore:Client:OnPlayerLoaded',function()PlayerJob=RSCore.Functions.GetPlayerData().job;TriggerServerEvent("t1ger_mechanicjob:fetchMechShops")end)RegisterNetEvent('RSCore:Client:OnJobUpdate')AddEventHandler('RSCore:Client:OnJobUpdate',function(b)PlayerJob=b end)Citizen.CreateThread(function()Wait(500)if RSCore.Functions.GetPlayerData()~=nil then PlayerJob=RSCore.Functions.GetPlayerData().job;onDuty=true end end)local c,d,e=nil,nil,nil;local f=0;Citizen.CreateThread(function()while true do local g=GetEntityCoords(PlayerPedId(),true)for h,i in pairs(Config.MechanicShops)do f=GetDistanceBetweenCoords(coords.x,coords.y,coords.z,i.menuPos[1],i.menuPos[2],i.menuPos[3],true)if f<=6.0 then bossMenuFunction(h,i,f)end;f=GetDistanceBetweenCoords(coords.x,coords.y,coords.z,i.storage[1],i.storage[2],i.storage[3],true)if f<=6.0 then storageMenuFunction(h,i,f)end;f=GetDistanceBetweenCoords(coords.x,coords.y,coords.z,i.workbench[1],i.workbench[2],i.workbench[3],true)if f<=6.0 then workbenchMenuFunction(h,i,f)end end;Citizen.Wait(1)end end)RegisterNetEvent('RSCore:Client:SetDuty')AddEventHandler('RSCore:Client:SetDuty',function(j)onDuty=j end)RegisterNetEvent("t1ger_mechanicjob:fetchMechShopsCL")AddEventHandler("t1ger_mechanicjob:fetchMechShopsCL",function(k)plyShopID=k;for h,i in pairs(shopBlips)do RemoveBlip(i)end;RSCore.Functions.TriggerCallback("t1ger_mechanicjob:getTakenShops",function(l)for h,i in pairs(l)do if i.shopID~=plyShopID then print(i.shopID)emptyShops[i.shopID]=i.shopID end end;for h,i in ipairs(Config.MechanicShops)do if plyShopID==h then for m,n in pairs(l)do if n.shopID==plyShopID then CreateShopBlips(h,i,n.name)break end end else if emptyShops[h]==h then for m,n in pairs(l)do if n.shopID==h then CreateShopBlips(h,i,n.name)end end else if Config.PurchasableMechBlip then CreateShopBlips(h,i,Lang["vacant_shops"])end end end end end)end)function bossMenuFunction(h,i,o)o=GetDistanceBetweenCoords(coords.x,coords.y,coords.z,i.menuPos[1],i.menuPos[2],i.menuPos[3],false)local p=Config.MarkerSettings;if o<=10.0 and o>=2.0 then if p.enable then DrawMarker(p.type,i.menuPos[1],i.menuPos[2],i.menuPos[3],0.0,0.0,0.0,0.0,0.0,0.0,p.scale.x,p.scale.y,p.scale.z,p.color.r,p.color.g,p.color.b,p.color.a,false,true,2,false,false,false,false)end elseif o<=2.0 then if plyShopID==h then RSCore.Functions.DrawText3D(i.menuPos[1],i.menuPos[2],i.menuPos[3],Lang["mech_shop_manage"])if IsControlJustPressed(0,Config.KeyToManageShop)then c=i;MechShopManageMenu(h,i)end else if emptyShops[h]==h then RSCore.Functions.DrawText3D(i.menuPos[1],i.menuPos[2],i.menuPos[3],Lang["no_access_to_shop"])else if plyShopID==0 then RSCore.Functions.DrawText3D(i.menuPos[1],i.menuPos[2],i.menuPos[3],Lang["press_to_buy_shop"]:format(math.floor(i.price)))if IsControlJustPressed(0,Config.KeyToBuyMechShop)then c=i;BuyMechShopMenu(h,i)end else RSCore.Functions.DrawText3D(i.menuPos[1],i.menuPos[2],i.menuPos[3],Lang["only_one_mech_shop"])end end end end end;function MechShopManageMenu(q,r)local button;local s={{label=Lang["rename_mech_shop"],value=1},{label=Lang["sell_mech_shop"],value=2},{label=Lang["employees_action"],value=3},{label=Lang["accounts_action"],value=4},{label="Close Menu",value=5}}local assert=assert;local t=assert(MenuV)Manage=MenuV:CreateMenu('Mech Shop','','topleft',255,0,0,'size-150')Manage1=MenuV:CreateMenu('Rename','','topleft',255,0,0,'size-150')MenuV:OpenMenu(Manage,function()end)button=Manage:AddButton({icon="ğŸ§‘â€ğŸ”§ ",label=Lang["rename_mech_shop"],value=1})button1=Manage:AddButton({icon="ğŸ§‘â€ğŸ”§ ",label=Lang["sell_mech_shop"],value=2})button2=Manage:AddButton({icon="ğŸ§‘â€ğŸ”§ ",label=Lang["employees_action"],value=3})button3=Manage:AddButton({icon="ğŸ§‘â€ğŸ”§ ",label=Lang["accounts_action"],value=4})button4=Manage:AddButton({icon="ğŸ§‘â€ğŸ”§ ",label="Close menu",value=5})local u=Manage1:AddConfirm({icon='ğŸ”¥',label='Confirm',value='no'})button:On("select",function()MenuV:Refresh()MenuV:OpenMenu(Manage1,function()end)u:On("confirm",function()local v=LocalInput("ShopName",20,"New Name")if v=="New Name"then RSCore.Functions.Notify("Cannot Use that name")else RSCore.Functions.TriggerCallback("t1ger_mechanicjob:renameMechShop",function(w)if w then ShowNotifyESX(Lang["mech_shop_renamed"]:format(v))TriggerServerEvent("t1ger_mechanicjob:fetchMechShops")MenuV:CloseMenu(Manage1)MenuV:Refresh()c=nil else ShowNotifyESX(Lang["not_your_mech_shop"])MenuV:Refresh()c=nil end end,q,r,v)end end)u:On("deny",function()MenuV:CloseMenu(Manage1)MenuV:CloseMenu(Manage)MenuV:Refresh()end)end)button1:On("select",function()SellMechShopMenu(q,r)end)button2:On("select",function()EmployeesMainMenu(q,r)end)button3:On("select",function()AccountsMainMenu(q,r)end)button4:On("select",function()Manage1:Close()Manage:Close()end)end;function LocalInput(x,y,z)DisplayOnscreenKeyboard(1,x or"FMMC_MPM_NA","",z or"","","","",y or 30)while UpdateOnscreenKeyboard()==0 do DisableAllControlActions(0)Wait(0)end;if GetOnscreenKeyboardResult()then local A=GetOnscreenKeyboardResult()return A end end;function LocalInputInt(x,y,z)DisplayOnscreenKeyboard(1,x or"FMMC_MPM_NA","",z or"","","","",y or 30)while UpdateOnscreenKeyboard()==0 do DisableAllControlActions(0)Wait(0)end;if GetOnscreenKeyboardResult()then local A=GetOnscreenKeyboardResult()return tonumber(A)end end;function AccountsMainMenu(q,r)local assert=assert;local MenuV=assert(MenuV)RSCore.Functions.TriggerCallback("t1ger_mechanicjob:getShopAccounts",function(B)jerico=B;MenuV:Refresh()end,q)local C=MenuV:CreateMenu("Account",'','topleft',255,0,0,'size-150')MenuV:OpenMenu(C,function()end)local button=C:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label=Lang["account_withdraw"],value=1})local button1=C:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label=Lang["account_deposit"],value=2})local button2=C:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label="Ammount Details",value=3})button2:On("select",function()RSCore.Functions.Notify("You Have in your account $"..jerico)MenuV:Refresh()MenuV:CloseMenu(C)end)button:On("select",function()local fx=LocalInput("withdraw",20,1)if fx~=nil or fx==0 then TriggerServerEvent("t1ger_mechanicjob:withdrawMoney",q,tonumber(fx))MechShopManageMenu(q,r)C=MenuV:CreateMenu("Account :$ ~r~"..jerico,'','topleft',255,0,0,'size-150')MenuV:Refresh()MenuV:CloseMenu(C)else MenuV:CloseMenu(C)MenuV:Refresh()RSCore.Functions.Notify("The Value is Invalid")end end)button1:On("select",function()local D=LocalInput("withdraw",20,1)if D~=nil or fx==0 then TriggerServerEvent("t1ger_mechanicjob:depositMoney",q,tonumber(D))MechShopManageMenu(q,r)MenuV:Refresh()MenuV:CloseMenu(Manage)else MenuV:CloseMenu(Manage)MenuV:Refresh()RSCore.Functions.Notify("The Value is Invalid")end end)end;function EmployeesMainMenu(q,r)local E=q;local assert=assert;local t=assert(MenuV)local Manage=MenuV:CreateMenu("Mech Shop [Employees]",'','topleft',255,0,0,'size-150')local Manage1=MenuV:CreateMenu("LIST",'','topleft',255,0,0,'size-150')MenuV:OpenMenu(Manage,function()end)button=Manage:AddButton({icon="ğŸ§‘â€ğŸ”§=> 	",label=Lang["hire_employee"],value=Manage1})button1=Manage:AddButton({icon="ğŸ§‘â€ğŸ”§=>	",label=Lang["employee_list"],value=1})botonvalue=nil;RSCore.Functions.TriggerCallback('t1ger_mechanicjob:getOnlinePlayers',function(F)local s={}for G=1,#F,1 do table.insert(s,{label=F[G].name,value=F[G].source,name=F[G].name,identifier=F[G].identifier})end;for h,i in ipairs(s)do button3=Manage1:AddButton({icon="ğŸ§‘â€ğŸ”§	",label=i.label,value=i,select=function(H)local u=Manage1:AddConfirm({icon='ğŸ”¥',label='Confirm',value='no'})botonvalue=H;u:On("confirm",function()local I=0;TriggerServerEvent('t1ger_mechanicjob:reqruitEmployee',q,RSCore.Functions.GetPlayerData(botonvalue.Value.identifier).steam,botonvalue.Value.name)MenuV:CloseMenu(Manage1)end)u:On("deny",function()Manage1:Close()end)end})end end)button1:On("select",function()OpenEmployeeListMenu(E,r)end)end;function OpenEmployeeListMenu(q,r)print(q)local s={}local assert=assert;local t=assert(MenuV)local Manage=MenuV:CreateMenu("Employee List",'','topleft',255,0,0,'size-150')local Manage1=MenuV:CreateMenu("Fire?",'','topleft',255,0,0,'size-150')MenuV:OpenMenu(Manage,function()end)RSCore.Functions.TriggerCallback("t1ger_mechanicjob:getEmployees",function(J)if J~=nil then for h,i in ipairs(J)do button3=Manage:AddButton({icon="ğŸ§‘â€ğŸ”§	",label=i.firstname.." "..i.lastname.." | "..i.jobGrade,value=i,select=function(H)local K=H.Value;OpenEmployeeData(K,K,q,r)end})end end end,q)end;function OpenEmployeeData(L,M,q,r)local s={{label=Lang["fire_employee"],value="fire_employee"},{label=Lang["employee_job_grade"],value="job_grade_manage"}}local assert=assert;local t=assert(MenuV)local N=MenuV:CreateMenu("Employee: "..M.firstname,"",'size-150')local O=MenuV:CreateMenu("Fire "..M.firstname,"",'size-150')local P=MenuV:CreateMenu("Current Job Grade: "..M.jobGrade,"",'size-150')MenuV:OpenMenu(N,function()end)local Q=N:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label="Fire?",value="fire_employee",description='Fire Employee'})local R=N:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label=Lang["employee_job_grade"],value="job_grade_manage",description='Grade Manager'})local S=P:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label="Grade Manager",value="job_grade_manage",description='Grade Manager'})local T=O:AddConfirm({icon='ğŸ”¥',label='Fire Employee?',value=false})Q:On("select",function()MenuV:OpenMenu(O)T:On("confirm",function()print("From Confirm"..M.identifier)TriggerServerEvent('t1ger_mechanicjob:fireEmployee',q,M.identifier)O:Close()EmployeesMainMenu(q,r)end)T:On("deny",function()O:Close()N:Close()EmployeesMainMenu(q,r)end)end)R:On("select",function()MenuV:OpenMenu(P)end)S:On("select",function()local U=LocalInputInt("jobgrade",2,1)print("id"..q.." Iden "..M.identifier.." New Grade "..U)TriggerServerEvent('t1ger_mechanicjob:updateEmployeJobGrade',q,M.identifier,U)P:Close()end)end;function SellMechShopMenu(q,r)local V=r.price*Config.SellPercent;local assert=assert;local t=assert(MenuV)local N=MenuV:CreateMenu("Confirm Sale | ","Price: $"..math.floor(V),'size-150')MenuV:OpenMenu(N,function()end)local u=N:AddConfirm({icon='ğŸ”¥',label='Confirm',value='no'})u:On("confirm",function()RSCore.Functions.TriggerCallback("t1ger_mechanicjob:sellMechShop",function(W)if W then TriggerServerEvent("t1ger_mechanicjob:fetchMechShops")ShowNotifyESX(Lang["mech_shop_sold"]:format(math.floor(V)))MenuV:CloseMenu(N)MenuV:Refresh()else ShowNotifyESX(Lang["not_your_mech_shop"])end end,q,r,math.floor(V))end)u:On("deny",function()MenuV:CloseMenu(N)end)end;function BuyMechShopMenu(q,r)local s={{label=Lang["button_yes"],value="confirm_purchase"},{label=Lang["button_no"],value="decline_purchase"}}local assert=assert;local t=assert(MenuV)local X=MenuV:CreateMenu('Buy Shop','Wanna Buy it?')MenuV:OpenMenu(X,function()end)local Q=X:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label=Lang["button_yes"],value="confirm_purchase",description='Yes'})Q:On('select',function()local v=LocalInput("buy",20,"Shop Name")RSCore.Functions.TriggerCallback("t1ger_mechanicjob:buyMechShop",function(Y)if Y then ShowNotifyESX(Lang["mech_shop_bought"]:format(math.floor(r.price)))TriggerServerEvent("t1ger_mechanicjob:fetchMechShops")MenuV:Refresh()MenuV:CloseMenu(X)c=nil else ShowNotifyESX(Lang["not_enough_money"])MenuV:Refresh()MenuV:CloseMenu(X)c=nil end end,q,r,v)MenuV:CloseMenu(X)end)end;function storageMenuFunction(h,i,Z)Z=GetDistanceBetweenCoords(coords.x,coords.y,coords.z,i.storage[1],i.storage[2],i.storage[3],false)while d~=nil and Z>2.0 do d=nil;Citizen.Wait(1)end;if d==nil then end;local p=Config.MarkerSettings;if Z<=10.0 and Z>=2.0 then if p.enable then DrawMarker(p.type,i.storage[1],i.storage[2],i.storage[3],0.0,0.0,0.0,0.0,0.0,0.0,p.scale.x,p.scale.y,p.scale.z,p.color.r,p.color.g,p.color.b,p.color.a,false,true,2,false,false,false,false)end elseif Z<=2.0 then RSCore.Functions.DrawText3D(i.storage[1],i.storage[2],i.storage[3],Lang["press_to_storage"])if IsControlJustPressed(0,38)then RSCore.Functions.TriggerCallback("t1ger_mechanicjob:checkAccess",function(_)if _ then d=i;MechShopStorageMenu(h,i)else TriggerEvent("notification","you don't have any access for this",2)end end,h)end end end;function MechShopStorageMenu(q,r)local a0=false;invItems={}local s={{label=Lang["storage_deposit"],value="storage_deposit"},{label=Lang['storage_withdraw'],value="storage_withdraw"}}local assert=assert;local t=assert(MenuV)local a1=MenuV:CreateMenu("Storage","",'size-150')local a2=MenuV:CreateMenu("Inventory","",'size-150')local a3=MenuV:CreateMenu(Lang['storage_withdraw'],"",'size-150')MenuV:OpenMenu(a1,function()end)for h,i in ipairs(s)do local a4=a1:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label=i.label,value=i,description=i.label,select=function(H)local a5=H.Value.value;if a5=="storage_deposit"then MenuV:OpenMenu(a2,function()end)MenuV:Refresh()elseif a5=="storage_withdraw"then MenuV:OpenMenu(a3,function()end)end end})RSCore.Functions.TriggerCallback('t1ger_mechanicjob:getUserInventory',function(a6)MenuV:Refresh()for h,i in pairs(a6)do if i.amount>0 then table.insert(invItems,{label=i.amount.."x "..i.label,value=i.name})end end;for h,i in pairs(invItems)do local Q=a2:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label=i.label,value=i,description=i.label,select=function(H)local K=H.Value.value;local a7=LocalInputInt("wachin",10,1)if a7==nil then ShowNotifyESX(Lang['invalid_amount'])MenuV:Refresh()else if a7>0 then if not a0 then a0=true;TriggerServerEvent('t1ger_mechanicjob:depositItem',K,tonumber(a7),q)a2:Close()MenuV:Refresh()end;a2:Close()MenuV:Refresh()else ShowNotifyESX(Lang['invalid_amount'])a2:Close()MenuV:Refresh()end end end})end;MenuV:Refresh()end)RSCore.Functions.TriggerCallback('t1ger_mechanicjob:getStorageInventory',function(a6)if a6~=nil then local a8={}for h,i in pairs(a6)do table.insert(a8,{label=i.count.."x "..i.label,value=i.item,amount=i.count})end;for h,i in pairs(a8)do local Q=a3:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label=i.label,value=i,description=i.label,select=function(H)local K=H.Value;print(K.value)local a7=LocalInputInt("storage",3,1)if a7==nil then ShowNotifyESX(Lang['invalid_amount'])else if a7>0 then if a7<=K.amount then if not a0 then a0=true;TriggerServerEvent('t1ger_mechanicjob:withdrawItem',K.value,a7,q)end else ShowNotifyESX(Lang['too_high_count'])end;Wait(500)MechShopStorageMenu(q,r)else ShowNotifyESX(Lang['invalid_amount'])end end;MenuV:Refresh()a3:Close()end})MenuV:Refresh()end;a2:Close()else ShowNotifyESX(Lang['storage_inv_empty'])end end,q)end end;function workbenchMenuFunction(h,i,a9)a9=GetDistanceBetweenCoords(coords.x,coords.y,coords.z,i.workbench[1],i.workbench[2],i.workbench[3],false)while e~=nil and a9>2.0 do e=nil;Citizen.Wait(1)end;if e==nil then end;local p=Config.MarkerSettings;if a9<10.0 and a9>2.0 then if p.enable then DrawMarker(p.type,i.workbench[1],i.workbench[2],i.workbench[3],0.0,0.0,0.0,0.0,0.0,0.0,p.scale.x,p.scale.y,p.scale.z,p.color.r,p.color.g,p.color.b,p.color.a,false,true,2,false,false,false,false)end elseif a9<2.0 then RSCore.Functions.DrawText3D(i.workbench[1],i.workbench[2],i.workbench[3],Lang["press_to_workbench"])if IsControlJustPressed(0,38)then RSCore.Functions.TriggerCallback("t1ger_mechanicjob:checkAccess",function(_)if _ then MechShopWorkbenchMenu(h,i)ShowNotifyESX("acceso autorizado")else ShowNotifyESX(Lang["no_access"])end end,h)end end end;function MechShopWorkbenchMenu(q,r)if not IsEntityPlayingAnim(player,'mini@repair','fixing_a_player',3)then LoadAnim('mini@repair')TaskPlayAnim(player,'mini@repair','fixing_a_player',8.0,-8,-1,49,0,0,0,0)end;local a0=false;local assert=assert;local t=assert(MenuV)local aa=MenuV:CreateMenu("Select Craftable","",'size-150')MenuV:OpenMenu(aa,function()end)local s={}local ab={{label=Lang['craft_item'],value="craft_item"},{label=Lang['view_recipe'],value="view_recipe"}}for h,i in ipairs(Config.Workbench)do table.insert(s,{label=i.label,item=i.item,recipe=i.recipe})end;for h,i in ipairs(s)do local Q=aa:AddButton({icon="ğŸ§‘â€ğŸ”§ ",label=i.label,value=i,description='Select item',select=function(H)local ac=H.Value;local ad=MenuV:CreateMenu("Craftable: "..ac.label,"",'size-150')MenuV:OpenMenu(ad,function()end)for ae,af in ipairs(ab)do local R=ad:AddButton({icon="ğŸ§‘â€ğŸ”§ ",label=af.label,value=af,description='Craft',select=function(ag)local ah=ag.Value;print(ah)if ah.value=="craft_item"then print("true")if not a0 then a0=true;RSCore.Functions.Progressbar("sell_pawn_items",Lang['crafting_item']:format(string.upper(ac.label)),Config.CraftTime*1000,false,true,{},{},{},{},function()end,function()end)Citizen.Wait(Config.CraftTime*1000)TriggerServerEvent('t1ger_mechanicjob:craftItem',ac.label,ac.item,ac.recipe,q,r)Wait(500)e=nil;ClearPedSecondaryTask(player)MenuV:CloseMenu(ad)else MechShopWorkbenchMenu(q,r)ShowNotifyESX(Lang['crafting_in_progress'])end elseif ah.value=="view_recipe"then ViewCraftingRecipe(ac.label,ac.item,ac.recipe,q,r)ClearPedSecondaryTask(player)end end})end end})end end;function ViewCraftingRecipe(ai,aj,ak,q,r)local s={}for h,i in ipairs(ak)do local al=Config.Materials[i.id]table.insert(s,{label=al.label.." ["..i.qty.." pcs]",name=al.label,item=al.item,amount=i.qty})end;local assert=assert;local t=assert(MenuV)local am=MenuV:CreateMenu("Recipe: ","",'size-150')MenuV:OpenMenu(am,function()end)for h,i in ipairs(s)do local button1=am:AddButton({icon="ğŸ§‘â€ğŸ”§ ",label=i.label,value=i,description='materials',select=function(ag)local ac=ag.Value;if ac=="menu_return"then MechShopWorkbenchMenu(q,r)MenuV:CloseMenu(am)end end})end end;vehOnLift={}Citizen.CreateThread(function()while true do Citizen.Wait(1)if PlayerJob and PlayerJob.name=="mechanic"then for an,ao in pairs(Config.MechanicShops)do local ap=GetDistanceBetweenCoords(coords.x,coords.y,coords.z,ao.menuPos[1],ao.menuPos[2],ao.menuPos[3],true)if ap<20.0 then local aq=ao.lifts;for h,i in pairs(aq)do local ar=GetDistanceBetweenCoords(coords.x,coords.y,coords.z,i.entry[1],i.entry[2],i.entry[3],true)if ar<6 and IsPedInAnyVehicle(player,1)then if ar>2.0 then DrawMarker(i.marker.type,i.entry[1],i.entry[2],i.entry[3],0.0,0.0,0.0,0.0,0.0,0.0,i.marker.scale.x,i.marker.scale.y,i.marker.scale.z,i.marker.color.r,i.marker.color.g,i.marker.color.b,i.marker.color.a,false,true,2,false,false,false,false)end;if ar<2.0 then if not i.inUse then RSCore.Functions.DrawText3D(i.entry[1],i.entry[2],i.entry[3],Lang["park_on_lift"])if IsControlJustPressed(0,38)then local as=GetVehicleNumberPlateText(curVehicle):gsub("^%s*(.-)%s*$","%1")i.currentVeh=curVehicle;i.inUse=true;TaskLeaveVehicle(player,i.currentVeh,0)Citizen.Wait(2000)SetEntityCoordsNoOffset(i.currentVeh,i.pos[1],i.pos[2],i.pos[3],true,false,false,true)SetEntityHeading(i.currentVeh,i.pos[4])SetVehicleOnGroundProperly(i.currentVeh)FreezeEntityPosition(i.currentVeh,true)local at=GetEntityCoords(i.currentVeh)i.pos[3]=at.z;print(at.z)vehOnLift[as]={entity=i.currentVeh,pos=i.pos,plate=as,health={}}TriggerServerEvent("t1ger_mechanicjob:liftStateSV",an,h,i,i.currentVeh,true)break end else RSCore.Functions.DrawText3D(i.entry[1],i.entry[2],i.entry[3],Lang["lift_occupied"])end end end;local au=GetDistanceBetweenCoords(coords.x,coords.y,coords.z,i.control[1],i.control[2],i.control[3],false)if au<6 and not IsPedInAnyVehicle(player,1)then if au>1.5 then DrawMarker(i.marker.type,i.control[1],i.control[2],i.control[3],0.0,0.0,0.0,0.0,0.0,0.0,i.marker.scale.x,i.marker.scale.y,i.marker.scale.z,i.marker.color.r,i.marker.color.g,i.marker.color.b,i.marker.color.a,false,true,2,false,false,false,false)end;if au<1.5 then if i.inUse then RSCore.Functions.DrawText3D(i.control[1],i.control[2],i.control[3],Lang["remove_or_move_veh"])if IsControlJustPressed(0,47)then Citizen.Wait(1000)FreezeEntityPosition(i.currentVeh,false)SetEntityCoords(i.currentVeh,i.entry[1],i.entry[2],i.entry[3],1,0,0,1)local as=GetVehicleNumberPlateText(i.currentVeh):gsub("^%s*(.-)%s*$","%1")if as==nil then RSCore.Functions.Notify("Plate number must not be null")end;vehOnLift[as]=nil;i.currentVeh=nil;i.inUse=false;TriggerServerEvent("t1ger_mechanicjob:liftStateSV",an,h,i,i.currentVeh,false)break elseif IsControlJustPressed(0,172)then if i.pos[3]<i.maxValue then i.pos[3]=i.pos[3]+0.1;SetEntityCoordsNoOffset(i.currentVeh,i.pos[1],i.pos[2],i.pos[3],1,0,0,1)Wait(100)else ShowNotifyESX(Lang["lift_cannot_go_higher"])end elseif IsControlJustPressed(0,173)then if i.pos[3]>i.minValue then i.pos[3]=i.pos[3]-0.1;SetEntityCoordsNoOffset(i.currentVeh,i.pos[1],i.pos[2],i.pos[3],1,0,0,1)Wait(100)else ShowNotifyESX(Lang["lift_cannot_go_lower"])end end else RSCore.Functions.DrawText3D(i.control[1],i.control[2],i.control[3],Lang["no_veh_to_control"])end end end end end end end end end)RegisterNetEvent("t1ger_mechanicjob:menu")AddEventHandler("t1ger_mechanicjob:menu",function()OpenMechanicActionMenu()end)function GetClosestPlayer()local av=RSCore.Functions.GetPlayersFromCoords()local aw=-1;local ax=-1;local coords=GetEntityCoords(GetPlayerPed(-1))for G=1,#av,1 do if av[G]~=PlayerId()then local g=GetEntityCoords(GetPlayerPed(av[G]))local f=GetDistanceBetweenCoords(g.x,g.y,g.z,coords.x,coords.y,coords.z,true)if aw==-1 or aw>f then ax=av[G]aw=f end end end;return ax,aw end;function OpenMechanicActionMenu()if RSCore.Functions.GetPlayerData().job.name=="mechanic"then local s={{label="Billing",value=1},{label="Use Car Jack",value=2},{label="Inspect Vehicle",value=3},{label="Repair Health Parts",value=4},{label="Vehicle Engine Repair",value=5},{label="Vehicle Body Repair",value=6},{label="NPC Jobs",value=7},{label="Objects",value=8}}local assert=assert;local t=assert(MenuV)MechMenu1=MenuV:CreateMenu("MECHANIC MENU","",'size-150')MenuV:OpenMenu(MechMenu1,function()end)local Q=MechMenu1:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label="Close Menu",value=1,description='Close the Menu'})for h,i in ipairs(s)do local a4=MechMenu1:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label=i.label,value=i,description=i.label,select=function(H)local a5=H.Value.value;if a5==1 then local ay=LocalInput("amount",20,1)if ay~=nil or not ay==0 then local ax,aw=GetClosestPlayer()if ax==-1 or aw>3.0 then ShowNotifyESX(Lang['no_players_nearby'])else TriggerServerEvent('t1ger_mechanicjob:sendBill',GetPlayerServerId(ax),ay)end else ShowNotifyESX(Lang['invalid_amount'])end elseif a5==2 then CarJackFunction('interact')elseif a5==3 then InspectVehicleFunction()elseif a5==4 then RepairVehicleHealthPart()elseif a5==5 then RepairVehicleEngine()elseif a5==6 then CarJackFunction('analyse')elseif a5==7 then ManageNpcJobs()elseif a5==8 then CarryObjectsMainMenu()end end})end;Q:On("select",function()MenuV:CloseMenu(MechMenu1)MechMenu1:Close()end)end end;carryModel=0;holdingObj=false;function CarryObjectsMainMenu()local s={}for h,i in pairs(Config.PropEmotes)do table.insert(s,{label=i.label,prop=i.model,bone=i.bone,pos=i.pos,rot=i.rot})end;table.insert(s,{label="Remove Obj",value="remove_obj"})local assert=assert;local t=assert(MenuV)local az=MenuV:CreateMenu("Select Craftable","",'size-150')MenuV:OpenMenu(az,function()end)for h,i in ipairs(s)do local Q=az:AddButton({icon="ğŸ§‘â€ğŸ”§ ",label=i.label,value=i,description='Select item',select=function(H)local ac=H.Value;print(ac.pos[1])if ac=="remove_obj"then local coords=GetEntityCoords(GetPlayerPed(-1))ClearPedTasks(PlayerPedId())ClearPedSecondaryTask(PlayerPedId())Citizen.Wait(250)DetachEntity(carryModel)local aA={"prop_roadcone02a","prop_tool_box_04","prop_cs_trolley_01","prop_engine_hoist"}for G=1,#aA,1 do local aB=GetClosestObjectOfType(coords,2.5,GetHashKey(aA[G]),false,false,false)if DoesEntityExist(aB)then DeleteObject(aB)end end;CarryObjectsMainMenu()else local coords=GetEntityCoords(GetPlayerPed(-1))local aC=ac;carryModel=0;holdingObj=true;if aC.prop=="prop_cs_trolley_01"or aC.prop=="prop_engine_hoist"then PlayPushObjAnim()end;CreateObject(aC.prop,coords.x,coords.y,coords.z,false,false,false)local aD=GetPedBoneIndex(PlayerPedId(),aC.bone)local aE,aF,aG,aH,aI,aJ=round(aC.pos[1],2),round(aC.pos[2],2),round(aC.pos[3],2),round(aC.rot[1],2),round(aC.rot[2],2),round(aC.rot[3],2)AttachEntityToEntity(carryModel,PlayerPedId(),aD,aE,aF,aG,aH,aI,aJ,true,true,false,true,2,1)end end})end end;Citizen.CreateThread(function()while true do Citizen.Wait(5)if IsControlJustPressed(0,Config.KeyToPushPickUpObjs)and carryModel~=0 then if PlayerData.job and PlayerData.job.name=="mechanic"then local aK={"prop_roadcone02a","prop_tool_box_04","prop_cs_trolley_01","prop_engine_hoist"}local coords,aL=GetEntityCoords(GetPlayerPed(-1)),-1;carryModel=nil;local aM,aN=nil,Config.PropEmotes;for G=1,#aK,1 do local aB=GetClosestObjectOfType(coords,1.5,GetHashKey(aK[G]),false,false,false)if DoesEntityExist(aB)then local aO=GetEntityCoords(aB)local aP=GetDistanceBetweenCoords(coords,aO,true)if aL==-1 or aL>aP then aL=aP;carryModel=aB;aM=aK[G]end end end;if holdingObj then holdingObj=false;if aM=="prop_roadcone02a"or aM=="prop_tool_box_04"then PlayPickUpAnim()end;Citizen.Wait(250)DetachEntity(carryModel)ClearPedTasks(PlayerPedId())ClearPedSecondaryTask(PlayerPedId())else local aQ=GetDistanceBetweenCoords(GetEntityCoords(carryModel),GetEntityCoords(PlayerPedId()),true)if aQ<1.75 then holdingObj=true;if aM=="prop_roadcone02a"or aM=="prop_tool_box_04"then PlayPickUpAnim()end;Citizen.Wait(250)ClearPedTasks(PlayerPedId())ClearPedSecondaryTask(PlayerPedId())if aM=="prop_cs_trolley_01"or aM=="prop_engine_hoist"then PlayPushObjAnim()end;Citizen.Wait(250)AttachEntityToEntity(carryModel,PlayerPedId(),GetPedBoneIndex(PlayerPedId(),aN[aM].bone),aN[aM].pos[1],aN[aM].pos[2],aN[aM].pos[3],aN[aM].rot[1],aN[aM].rot[2],aN[aM].rot[3],true,true,false,true,2,1)end end end end end end)function PlayPushObjAnim()LoadAnim("anim@heists@box_carry@")TaskPlayAnim(PlayerPedId(),"anim@heists@box_carry@","idle",4.0,1.0,-1,49,0,0,0,0)end;function PlayPickUpAnim()LoadAnim("random@domestic")TaskPlayAnim(PlayerPedId(),"random@domestic","pickup_low",5.0,1.0,1.0,48,0.0,0,0,0)end;function RepairVehicleEngine()local vehicle=GetClosestVehicle(coords.x,coords.y,coords.z,5.0,0,71)local as=GetVehicleNumberPlateText(vehicle):gsub("^%s*(.-)%s*$","%1")local aR=false;if vehicle~=0 then if vehOnLift[as]~=nil then if GetEntityModel(GetHashKey(vehicle))==GetEntityModel(GetHashKey(vehOnLift[as].entity))then local aS,aT=GetModelDimensions(GetEntityModel(vehicle))local aU=GetOffsetFromEntityInWorldCoords(vehicle,0.0,aT.y+0.2,0.0)local f=GetDistanceBetweenCoords(coords,vector3(aU.x,aU.y,aU.z),true)while true do Citizen.Wait(1)f=GetDistanceBetweenCoords(coords,vector3(aU.x,aU.y,aU.z),true)if f<5.0 then RSCore.Functions.DrawText3D(aU.x,aU.y,aU.z,Lang["repair_engine"])if IsControlJustPressed(0,38)and f<1.0 then TaskTurnPedToFaceEntity(player,vehicle,1.0)Citizen.Wait(1000)TaskStartScenarioInPlace(player,"WORLD_HUMAN_CLIPBOARD",0,true)RSCore.Functions.Progressbar("sell_pawn_items","INSPECTING: ENGINE",2000,false,true,{},{},{},{},function()end,function()end)Citizen.Wait(2000)ClearPedTasks(player)local aV=round(GetVehicleEngineHealth(vehicle)/10/10,2)if aV<10.0 then local aW={}for aX,ae in pairs(Config.HealthParts)do if ae.degName=="engine"then local aY={}aW=ae.materials;for h,i in pairs(ae.materials)do local aj=Config.Materials[i.id]table.insert(aY,aj.label)end;local aZ=table.concat(aY,", ")local a_="^*"..ae.label.." ["..aZ.."] Â» "..round(aV,2).." / 10.0"TriggerEvent("chat:addMessage",{args={a_}})end end;local b0=0;local b1=10.0;local b2=b1-aV;if b2>0 and b2<=1.0 then b0=1.0 else b0=math.floor(b2+1.0)end;RSCore.Functions.TriggerCallback("t1ger_mechanicjob:getMaterialsForHealthRep",function(b3)if b3 then SetEntityHeading(player,GetEntityHeading(vehicle))Citizen.Wait(500)TaskStartScenarioInPlace(player,"WORLD_HUMAN_VEHICLE_MECHANIC",0,true)RSCore.Functions.Progressbar("sell_pawn_items","REPAIRING: ENGINE",3500,false,true,{},{},{},{},function()end,function()end)Citizen.Wait(3500)SetVehicleEngineHealth(vehicle,1000.0)ClearPedTasks(player)else ShowNotifyESX(Lang["need_more_materials"])end end,as,"engine",aW,10.0,b0,vehOnLift)else ShowNotifyESX("Engine is fully functional")end;break end end;if f>5.0 then aR=false;break end end else print("veh not matched")end else ShowNotifyESX(Lang["veh_must_be_on_lift"])end else ShowNotifyESX(Lang["no_vehicle_nearby"])end end;function RepairVehicleHealthPart()local vehicle=GetClosestVehicle(coords.x,coords.y,coords.z,5.0,0,71)local as=GetVehicleNumberPlateText(vehicle):gsub("^%s*(.-)%s*$","%1")local s={}local b4={}for h,i in pairs(Config.HealthParts)do table.insert(s,{label=i.label,degName=i.degName,materials=i.materials})end;local assert=assert;local t=assert(MenuV)local b5=MenuV:CreateMenu("MECHANIC MENU","",'size-150')MenuV:OpenMenu(b5,function()end)if vehicle~=0 then if vehOnLift[as]~=nil then if GetEntityModel(GetHashKey(vehicle))==GetEntityModel(GetHashKey(vehOnLift[as].entity))then if vehOnLift[as].health~=nil then for h,i in ipairs(s)do local a4=b5:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label=i.label,value=i,description=i.label,select=function(H)local b6=H.Value;print(b6.materials)local b1=LocalInputInt("input",20,1)if vehOnLift[as].health[b6.degName]~=nil then if b1>10.0 then ShowNotifyESX(Lang['health_part_exceeded'])elseif b1<vehOnLift[as].health[b6.degName].value then ShowNotifyESX(Lang['not_decrease_health_val'])else local b2=b1-vehOnLift[as].health[b6.degName].value;local b7=0;if b2<=0 then ShowNotifyESX(Lang['not_decrse_or_same_val'])ShowNotifyESX("Value "..vehOnLift[as].health[b6.degName].value)else if b2>0 and b2<=1.0 then b7=1.0 else b7=math.floor(b2+1.0)end;RepairSelectedHealthPart(as,b6.label,b6.degName,b6.materials,b1,b7)end end else ShowNotifyESX(Lang['veh_must_be_inspected'])end;MenuV:CloseMenu("Repair")end})end else ShowNotifyESX(Lang["veh_must_be_inspected"])end else print("veh not matched")end else ShowNotifyESX(Lang["veh_must_be_on_lift"])end else ShowNotifyESX(Lang["no_vehicle_nearby"])end end;function RepairSelectedHealthPart(as,b8,b9,ba,b1,bb)print(ba)local vehicle=GetClosestVehicle(coords.x,coords.y,coords.z,5.0,0,71)local bc=false;if vehicle~=0 then local aS,aT=GetModelDimensions(GetEntityModel(vehicle))local aU=GetOffsetFromEntityInWorldCoords(vehicle,0.0,aT.y+0.2,0.0)local f=GetDistanceBetweenCoords(coords,vector3(aU.x,aU.y,aU.z),true)while true do Citizen.Wait(1)f=GetDistanceBetweenCoords(coords,vector3(aU.x,aU.y,aU.z),true)if f<5.0 then RSCore.Functions.DrawText3D(aU.x,aU.y,aU.z,Lang["health_rep_here"])if IsControlJustPressed(0,38)and f<1.0 then SetEntityHeading(player,GetEntityHeading(vehicle))Citizen.Wait(500)TaskStartScenarioInPlace(player,"WORLD_HUMAN_VEHICLE_MECHANIC",0,true)RSCore.Functions.Progressbar("sell_pawn_items",Lang["lift_repairing_veh"]:format(string.upper(b8)),3500,false,true,{},{},{},{},function()end,function()end)Citizen.Wait(3500)ClearPedTasks(player)RSCore.Functions.TriggerCallback("t1ger_mechanicjob:getMaterialsForHealthRep",function(b3)if b3 then vehOnLift[as].health[b9].value=round(b1,2)TriggerServerEvent("t1ger_mechanicjob:updateVehDegradation",as,b8,b9,vehOnLift)if b9=="engine"then local aV=round(vehOnLift[as].health[b9].value*10*10,2)SetVehicleEngineHealth(vehicle,aV)end else ShowNotifyESX(Lang["need_more_materials"])end end,as,b9,ba,b1,bb,vehOnLift)break end end;if f>5.0 then bc=false;break end end else ShowNotifyESX(Lang["no_vehicle_nearby"])end end;function InspectVehicleFunction()local vehicle=GetClosestVehicle(coords.x,coords.y,coords.z,5.0,0,71)local as=GetVehicleNumberPlateText(vehicle):gsub("^%s*(.-)%s*$","%1")if vehicle~=0 then if vehOnLift[as]~=nil then if GetEntityModel(GetHashKey(vehicle))==GetEntityModel(GetHashKey(vehOnLift[as].entity))then local aS,aT=GetModelDimensions(GetEntityModel(vehicle))local bd={[1]={pos=GetOffsetFromEntityInWorldCoords(vehicle,aT.x+0.2,0.0,0.0),scenario="WORLD_HUMAN_CLIPBOARD",done=false},[2]={pos=GetOffsetFromEntityInWorldCoords(vehicle,0.0,aT.y+0.2,0.0),scenario="WORLD_HUMAN_CLIPBOARD",done=false},[3]={pos=GetOffsetFromEntityInWorldCoords(vehicle,aS.x-0.2,0.0,0.0),scenario="WORLD_HUMAN_CLIPBOARD",done=false}}local be=false;while true do Citizen.Wait(1)local bf=GetEntityCoords(vehicle,1)if not be then for h,i in pairs(bd)do local f=GetDistanceBetweenCoords(GetEntityCoords(player),vector3(i.pos.x,i.pos.y,i.pos.z),true)if f<4.0 then if not i.done then RSCore.Functions.DrawText3D(i.pos.x,i.pos.y,i.pos.z,Lang["inspect_here"])if IsControlJustPressed(0,38)and f<1.0 then TaskTurnPedToFaceEntity(player,vehicle,1.0)Citizen.Wait(1000)TaskStartScenarioInPlace(player,i.scenario,0,true)RSCore.Functions.Progressbar("sell_pawn_items",Lang["progbar_inspecting_veh"],1500,false,true,{},{},{},{},function()end,function()end)Citizen.Wait(1500)ClearPedTasksImmediately(player)i.done=true end end end end;if bd[1].done and bd[2].done and bd[3].done then be=true;Wait(200)break end end end;print(as)RSCore.Functions.TriggerCallback("t1ger_mechanicjob:getVehDegradation",function(bg)print("called vehdegradation")local bh={}if bg~=nil then for h,i in pairs(bg)do local bi=round(i.value/10,2)if i.part=="engine"then bi=round(GetVehicleEngineHealth(vehicle)/10/10,2)end;for aX,ae in pairs(Config.HealthParts)do if ae.degName==i.part then bh[i.part]={value=bi,materials=ae.materials}local aY={}for h,i in pairs(ae.materials)do local aj=Config.Materials[i.id]table.insert(aY,aj.label)end;local aZ=table.concat(aY,", ")RSCore.Functions.Notify("*"..ae.label.." ["..aZ.."] Â» "..round(bi,2).." / 10.0")end end end;vehOnLift[as].health=bh else ShowNotifyESX("Works with only player owned vehicles.")end end,as)else print("veh not matched")end else ShowNotifyESX(Lang["veh_must_be_on_lift"])end else ShowNotifyESX(Lang["no_vehicle_nearby"])end end;usingJack=false;isJackRaised=false;carJackObj=nil;vehicleData={}wheelProperties={}vehAnalysed=false;function CarJackFunction(type)local vehicle=GetClosestVehicle(coords.x,coords.y,coords.z,5.0,0,71)if vehicle~=0 then if usingJack then return end;usingJack=true;GetControlOfEntity(vehicle)local aS,aT=GetModelDimensions(GetEntityModel(vehicle))local bj=GetOffsetFromEntityInWorldCoords(vehicle,aT.x+0.2,0.0,0.0)local bk=GetEntityCoords(vehicle,1)local f=GetDistanceBetweenCoords(coords,vector3(bj.x,bj.y,bj.z),true)while true do Citizen.Wait(1)f=GetDistanceBetweenCoords(coords,vector3(bj.x,bj.y,bj.z),true)if f<6.0 then local b8=""local bl=GetClosestObjectOfType(bk.x,bk.y,bk.z,1.0,GetHashKey("prop_carjack"),false,false,false)if DoesEntityExist(bl)then isJackRaised=true;if type=="interact"then b8=Lang["lower_jack"]end;if type=="analyse"then if not vehAnalysed then b8="Analyse Vehicle Body"else ShowNotifyESX(Lang["veh_already_analyzed"])break end end else if type=="interact"then isJackRaised=false;b8=Lang["raise_jack"]elseif type=="analyse"then ShowNotifyESX(Lang["raise_veh_b4_analyze"])break end end;RSCore.Functions.DrawText3D(bj.x,bj.y,bj.z,"~r~[E]~s~ "..b8)if IsControlJustPressed(0,38)and f<1.0 then if isJackRaised then if type=="interact"then UseTheJackFunction(vehicle)break else if not vehAnalysed then local as=GetVehicleNumberPlateText(vehicle):gsub("^%s*(.-)%s*$","%1")vehicleData[as]={report={},entity=nil}wheelProperties[as]={}for G=0,GetVehicleNumberOfWheels(vehicle)-1 do wheelProperties[as][G+1]={xOffset=GetVehicleWheelXOffset(vehicle,G),yRotation=GetVehicleWheelYRotation(vehicle,G)}end;FetchVehicleBodyDamageReport(vehicle,as)break end end else local aj=Config.CarJackItem;RSCore.Functions.TriggerCallback("t1ger_mechanicjob:getInventoryItem",function(bm)if bm then UseTheJackFunction(vehicle)else ShowNotifyESX(Lang["car_jack_carry"])end end,aj)end;break end end;if f>6.0 then usingJack=false;break end end else ShowNotifyESX(Lang["no_vehicle_nearby"])end;usingJack=false end;function UseTheJackFunction(vehicle)TaskTurnPedToFaceEntity(player,vehicle,1.0)Citizen.Wait(1000)FreezeEntityPosition(vehicle,true)local bf=GetEntityCoords(vehicle)if not isJackRaised then SpawnJackProp(vehicle)Citizen.Wait(250)else if DoesEntityExist(carJackObj)then GetControlOfEntity(carJackObj)SetEntityAsMissionEntity(carJackObj)SetVehicleHasBeenOwnedByPlayer(carJackObj,true)else carJackObj=GetClosestObjectOfType(bf.x,bf.y,bf.z,1.2,GetHashKey("prop_carjack"),false,false,false)GetControlOfEntity(carJackObj)SetEntityAsMissionEntity(carJackObj)SetVehicleHasBeenOwnedByPlayer(carJackObj,true)end end;local bn=GetEntityCoords(carJackObj)local bo="anim@amb@business@weed@weed_inspecting_lo_med_hi@"local bp="weed_crouch_checkingleaves_idle_02_inspector"LoadAnim(bo)local b8=""if isJackRaised then b8=Lang["progbar_lowering_jack"]else b8=Lang["progbar_raising_jack"]end;RSCore.Functions.Progressbar("sell_pawn_items",b8,6500,false,true,{},{},{},{},function()end,function()end)TaskPlayAnim(player,bo,bp,2.0,-3.5,-1,1,false,false,false,false)Citizen.Wait(1000)ClearPedTasks(player)local a7=5;while true do bf=GetEntityCoords(vehicle)bn=GetEntityCoords(carJackObj)if a7>0 then TaskPlayAnim(player,bo,bp,3.5,-3.5,-1,1,false,false,false,false)Citizen.Wait(1000)ClearPedTasks(player)if not isJackRaised then SetEntityCoordsNoOffset(vehicle,bf.x,bf.y,bf.z+0.10,true,false,false,true)SetEntityCoordsNoOffset(carJackObj,bn.x,bn.y,bn.z+0.10,true,false,false,true)else SetEntityCoordsNoOffset(vehicle,bf.x,bf.y,bf.z-0.10,true,false,false,true)SetEntityCoordsNoOffset(carJackObj,bn.x,bn.y,bn.z-0.10,true,false,false,true)end;FreezeEntityPosition(vehicle,true)FreezeEntityPosition(carJackObj,true)a7=a7-1 end;if a7<=0 then ClearPedTasks(player)if isJackRaised then FreezeEntityPosition(vehicle,false)if DoesEntityExist(carJackObj)then DeleteEntity(carJackObj)DeleteObject(carJackObj)end;carJackObj=nil;isJackRaised=false else isJackRaised=true end;usingJack=false;break end end;ClearPedTasks(player)end;function FetchVehicleBodyDamageReport(vehicle,as)local aS,aT=GetModelDimensions(GetEntityModel(vehicle))local bd={[1]={pos=GetOffsetFromEntityInWorldCoords(vehicle,aT.x+0.2,0.0,0.0),scenario="WORLD_HUMAN_WELDING",done=false},[2]={pos=GetOffsetFromEntityInWorldCoords(vehicle,0.0,aT.y+0.2,0.0),scenario="WORLD_HUMAN_VEHICLE_MECHANIC",done=false},[3]={pos=GetOffsetFromEntityInWorldCoords(vehicle,aS.x-0.2,0.0,0.0),scenario="WORLD_HUMAN_MAID_CLEAN",done=false},[4]={pos=GetOffsetFromEntityInWorldCoords(vehicle,0.0,aS.y-0.2,0.0),scenario="WORLD_HUMAN_CLIPBOARD",done=false}}while true do Citizen.Wait(1)local bf=GetEntityCoords(vehicle)for h,i in pairs(bd)do local f=GetDistanceBetweenCoords(coords,vector3(i.pos.x,i.pos.y,i.pos.z),true)if f<4.0 then if not i.done then RSCore.Functions.DrawText3D(i.pos.x,i.pos.y,i.pos.z,Lang["analyze_here"])if IsControlJustPressed(0,38)and f<1.0 then if h==2 then SetEntityHeading(player,GetEntityHeading(vehicle))Citizen.Wait(500)else TaskTurnPedToFaceEntity(player,vehicle,1.0)Citizen.Wait(1000)end;TaskStartScenarioInPlace(player,i.scenario,0,true)RSCore.Functions.Progressbar("sell_pawn_items",Lang["progbar_analyzing_veh"],2500,false,true,{},{},{},{},function()end,function()end)Citizen.Wait(2500)ClearPedTasks(player)i.done=true end end end end;if bd[1].done and bd[2].done and bd[3].done and bd[4].done then break end end;local bq={doors={},wheels={},engine=nil,body=nil}for G=0,GetNumberOfVehicleDoors(vehicle)+1 do if IsVehicleDoorDamaged(vehicle,G)then bq.doors[G+1]=true;local b8,br="",""if G>=0 and G<=3 then if G==0 then br="Left Front"elseif G==1 then br="Right Front"elseif G==2 then br="Back Left"elseif G==3 then br="Back Right"end;b8="Door ["..br.."] Â»  Damaged Â» Replace the Door"end;if G==4 then b8="Door [Hood] Â»  Damaged Â» Replace the Hood"elseif G==5 then b8="Door [Trunk] Â»  Damaged Â» Replace the Trunk"elseif G==6 then b8="Door [Trunk2] Â»  Damaged Â» Replace the trunk"end;TriggerEvent("chat:addMessage",{args={b8}})else bq.doors[G+1]=false end end;for G=0,GetVehicleNumberOfWheels(vehicle)-1 do if G==0 or G==1 then if IsVehicleTyreBurst(vehicle,G)or GetVehicleWheelXOffset(vehicle,G)==9999.0 then bq.wheels[G+1]=true;local b8=""if G==0 then b8="^*Wheel [Left Front] Â»  Bursted Â» Replace the Wheel"elseif G==1 then b8="^*Wheel [Right Front] Â»  Bursted Â» Replace the Wheel"end;TriggerEvent("chat:addMessage",{args={b8}})else bq.wheels[G+1]=false end end;if G==2 then if IsVehicleTyreBurst(vehicle,4)or GetVehicleWheelXOffset(vehicle,G)==9999.0 then bq.wheels[G+1]=true;local b8="Wheel [Back Left] Â»  Bursted Â» Replace the Wheel"TriggerEvent("chat:addMessage",{args={b8}})else bq.wheels[G+1]=false end end;if G==3 then if IsVehicleTyreBurst(vehicle,5)or GetVehicleWheelXOffset(vehicle,G)==9999.0 then bq.wheels[G+1]=true;local b8="Wheel [Back Right] Â»  Bursted Â» Replace the Wheel"TriggerEvent("chat:addMessage",{args={b8}})else bq.wheels[G+1]=false end end end;bq.engine=GetVehicleEngineHealth(vehicle)bq.body=GetVehicleBodyHealth(vehicle)SetVehicleCanDeformWheels(vehicle,false)Wait(500)vehicleData[as]={report=bq,entity=vehicle}vehAnalysed=true;RefreshVehicleDamage(vehicleData[as].entity,as)end;installingPart=false;carryObj=nil;RegisterNetEvent("t1ger_mechanicjob:installBodyPartCL")AddEventHandler("t1ger_mechanicjob:installBodyPartCL",function(q,r)local vehicle=GetClosestVehicle(coords.x,coords.y,coords.z,5.0,0,71)if vehicle~=0 then if vehAnalysed then else return ShowNotifyESX(Lang["analyze_veh_first"])end;GetControlOfEntity(vehicle)local bk=GetEntityCoords(vehicle,1)local f=GetDistanceBetweenCoords(coords,bk,false)if not installingPart then if not DoesEntityExist(carryObj)then local bo="anim@heists@box_carry@"LoadAnim(bo)TaskPlayAnim(player,bo,"idle",6.0,-2.0,-1,50,0,false,false,false)SpawnObject(r.prop,{x=coords.x,y=coords.y,z=coords.z},function(bs)carryObj=bs;local aD=GetPedBoneIndex(player,28422)AttachEntityToEntity(bs,player,aD,r.pos[1],r.pos[2],r.pos[3],r.rot[1],r.rot[2],r.rot[3],true,true,false,true,1,true)end)end;while true do Citizen.Wait(1)f=GetDistanceBetweenCoords(coords,bk,false)if f<4.0 then local bl=GetClosestObjectOfType(bk.x,bk.y,bk.z,1.0,GetHashKey("prop_carjack"),false,false,false)if DoesEntityExist(bl)then RSCore.Functions.DrawText3D(bk.x,bk.y,bk.z,Lang["install_body_part"])if IsControlJustPressed(0,47)and f<1.5 then installingPart=true;local as=GetVehicleNumberPlateText(vehicle):gsub("^%s*(.-)%s*$","%1")if q==1 then for G=0,GetNumberOfVehicleDoors(vehicleData[as].entity)-2 do if vehicleData[as].report.doors[G+1]==true then vehicleData[as].report.doors[G+1]=false;TriggerServerEvent("t1ger_mechanicjob:syncVehicleBodySV",as)TriggerServerEvent("t1ger_mechanicjob:removeItem",r.item,1)break else if tonumber(G+1)==tonumber(GetNumberOfVehicleDoors(vehicleData[as].entity)-2)then ShowNotifyESX(Lang["all_doors_intact"])break end end end end;if q==2 then if vehicleData[as].report.doors[4+1]==true then vehicleData[as].report.doors[4+1]=false;TriggerServerEvent("t1ger_mechanicjob:syncVehicleBodySV",as)TriggerServerEvent("t1ger_mechanicjob:removeItem",r.item,1)else ShowNotifyESX(Lang["hood_already_installed"])end end;if q==3 then if vehicleData[as].report.doors[5+1]==true then vehicleData[as].report.doors[5+1]=false;TriggerServerEvent("t1ger_mechanicjob:syncVehicleBodySV",as)TriggerServerEvent("t1ger_mechanicjob:removeItem",r.item,1)else ShowNotifyESX(Lang["trunk_already_installed"])end end;if q==4 then for G=0,GetVehicleNumberOfWheels(vehicleData[as].entity)-1 do if GetVehicleWheelXOffset(vehicleData[as].entity,G)==9999.0 then if vehicleData[as].report.wheels[G+1]==true then vehicleData[as].report.wheels[G+1]=false;TriggerServerEvent("t1ger_mechanicjob:syncVehicleBodySV",as)TriggerServerEvent("t1ger_mechanicjob:removeItem",r.item,1)break end else if tonumber(G+1)==tonumber(GetVehicleNumberOfWheels(vehicleData[as].entity)-1)then ShowNotifyESX(Lang["all_wheels_intact"])SetVehicleCanDeformWheels(vehicle,true)end end end end;DetachEntity(carryObj,1,0)DeleteObject(carryObj)carryObj=nil;ClearPedTasks(player)Citizen.Wait(100)local bt=GetBodyRepairProgression(vehicle)ShowNotifyESX("Progression: ["..bt.."/100]")if bt>=100 then SetVehicleCanDeformWheels(vehicle,true)Wait(100)SetVehicleFixed(vehicle)SetVehicleBodyHealth(vehicle,1000.0)vehAnalysed=false;ShowNotifyESX(Lang["all_body_repairs_done"])end;break end else ShowNotifyESX(Lang["raise_and_analyze"])break end end;if f>4.0 then break end end else ShowNotifyESX(Lang["finish_current_install"])end else ShowNotifyESX(Lang["no_vehicle_nearby"])end;installingPart=false end)function RefreshVehicleDamage(vehicle,as)SetVehicleFixed(vehicle)for G=0,GetNumberOfVehicleDoors(vehicle)+1 do if vehicleData[as].report.doors[G+1]==true then SetVehicleDoorBroken(vehicle,G,true)end end;if vehicleData[as].report.engine~=nil then SetVehicleEngineHealth(vehicle,tonumber(vehicleData[as].report.engine))else SetVehicleEngineHealth(vehicle,0)end;if vehicleData[as].report.body~=nil then SetVehicleBodyHealth(vehicle,tonumber(vehicleData[as].report.body))else SetVehicleBodyHealth(vehicle,800)end;for G=0,GetVehicleNumberOfWheels(vehicle)-1 do if vehicleData[as].report.wheels[G+1]==true then SetVehicleWheelsCanBreak(vehicle,G)SetVehicleWheelHealth(vehicle,G,100.0)SetVehicleWheelXOffset(vehicle,G,9999.0)SetVehicleWheelYRotation(vehicle,G,-90.0)else SetVehicleWheelsCanBreak(vehicle,G,false)SetVehicleWheelHealth(vehicle,G,100.0)SetVehicleWheelXOffset(vehicle,G,wheelProperties[as][G+1].xOffset)SetVehicleWheelYRotation(vehicle,G,wheelProperties[as][G+1].yRotation)end end;RemoveVehicleWindow(vehicle,0)RemoveVehicleWindow(vehicle,1)RemoveVehicleWindow(vehicle,2)RemoveVehicleWindow(vehicle,3)end;local bu=false;RegisterNetEvent("t1ger_mechanicjob:useRepairKit")AddEventHandler("t1ger_mechanicjob:useRepairKit",function(type,r)local vehicle=nil;vehicle=GetClosestVehicle(coords.x,coords.y,coords.z,5.0,0,71)if vehicle~=0 then if bu then return end;bu=true;local bv=15;NetworkRequestControlOfEntity(vehicle)while not NetworkHasControlOfEntity(vehicle)and bv>0 do NetworkRequestControlOfEntity(vehicle)Citizen.Wait(100)bv=bv-1 end;local aS,aT=GetModelDimensions(GetEntityModel(vehicle))local bw=GetOffsetFromEntityInWorldCoords(vehicle,0.0,aT.y+0.2,0.0)local f=GetDistanceBetweenCoords(GetEntityCoords(player,1),vector3(bw.x,bw.y,bw.z),true)local bx=false;while not bx do Citizen.Wait(1)f=GetDistanceBetweenCoords(GetEntityCoords(player,1),vector3(bw.x,bw.y,bw.z),true)RSCore.Functions.DrawText3D(bw.x,bw.y,bw.z,Lang["repair_here"])if IsControlJustPressed(0,38)then if f<1.0 then SetVehicleDoorOpen(vehicle,4,0,0)TaskTurnPedToFaceEntity(player,vehicle,1.0)Citizen.Wait(1000)local by="mini@repair"LoadAnim(by)if not IsEntityPlayingAnim(player,by,"fixing_a_player",3)then TaskPlayAnim(player,by,"fixing_a_player",5.0,-5,-1,16,false,false,false,false)end;RepairVehOptions(vehicle,type,r)if math.random(100)>r.chanceToKeep then TriggerServerEvent("t1ger_mechanicjob:removeItem",r.item,1)ShowNotifyESX(Lang["repair_kit_broke"])end;SetVehicleDoorShut(vehicle,4,1,1)ClearPedTasks(player)ShowNotifyESX(Lang["repairkit_veh_repaired"])bx=true;bu=false;break else f=GetDistanceBetweenCoords(GetEntityCoords(player,1),vector3(bw.x,bw.y,bw.z),true)end end end end;bu=false end)function RepairVehOptions(bz,type,r)local bA=(3000-GetVehicleEngineHealth(vehicle)-GetVehicleBodyHealth(vehicle)/2)*2+r.repairTime;RSCore.Functions.Progressbar("sell_pawn_items",bA,r.progbar,false,true,{},{},{},{},function()end,function()end)Citizen.Wait(bA)if type==1 then if GetVehicleEngineHealth(bz)<200.0 then SetVehicleEngineHealth(bz,200.0)end;if GetVehicleBodyHealth(bz)<910.0 then SetVehicleBodyHealth(bz,910.0)end;for G=0,math.random(5)do SetVehicleTyreFixed(bz,G)end end;if type==2 then if GetVehicleEngineHealth(bz)<200.0 then SetVehicleEngineHealth(bz,450.0)end;if GetVehicleBodyHealth(bz)<910.0 then SetVehicleBodyHealth(bz,975.0)end;for G=0,5 do SetVehicleTyreFixed(bz,G)end end end;Citizen.CreateThread(function()Citizen.Wait(1000)local a7=0;while true do Citizen.Wait(1000)if IsPedInVehicle(player,curVehicle,false)then a7=a7+1;if a7>=Config.WaitCountForHealth then if player==driver then local as=GetVehicleNumberPlateText(curVehicle):gsub("^%s*(.-)%s*$","%1")local bB=math.ceil(GetVehicleEngineHealth(curVehicle))local bC=math.ceil(GetVehicleBodyHealth(curVehicle))ApplyVehicledegradation(curVehicle,as)end;a7=0 end end end end)function ApplyVehicledegradation(curVehicle,as)RSCore.Functions.TriggerCallback("t1ger_mechanicjob:getIfVehicleOwned",function(bD)if bD then RSCore.Functions.TriggerCallback("t1ger_mechanicjob:getVehDegradation",function(bg)if bg~=nil then local bh={}for h,i in pairs(bg)do local bi=round(i.value/10,2)bh[i.part]=i.value end;if bh["electronics"]<=40 then local bE,bF=math.random(1,100),bh["electronics"]if bF<=40 and bF>=25 and bE>85 then for G=0,10 do Citizen.Wait(50)ElectronicsEffects(curVehicle)end end;if bF<=24 and bF>=10 and bE>70 then for G=0,10 do Citizen.Wait(100)ElectronicsEffects(curVehicle)end end;if bF<=9 and bF>=0 and bE>50 then for G=0,10 do Citizen.Wait(200)ElectronicsEffects(curVehicle)end end end;if bh["fuelinjector"]<=40 then local bE,bG=math.random(1,100),bh["fuelinjector"]if bG<=40 and bG>=25 and bE>85 then FuelInjectorEffects(curVehicle,200)end;if bG<=24 and bG>=10 and bE>70 then FuelInjectorEffects(curVehicle,500)end;if bG<=9 and bG>=0 and bE>50 then FuelInjectorEffects(curVehicle,1000)end end;if bh["brakes"]<=40 then local bE,bH=math.random(1,100),bh["brakes"]if bH<=40 and bH>=25 and bE>85 then BrakesEffects(curVehicle,1000)end;if bH<=24 and bH>=10 and bE>70 then BrakesEffects(curVehicle,4000)end;if bH<=9 and bH>=0 and bE>50 then BrakesEffects(curVehicle,8000)end end;if bh["radiator"]<=40 then local bE,bI=math.random(1,100),bh["radiator"]if bI<=40 and bI>=25 then RadiatorEffects(curVehicle,bE,1000)end;if bI<=24 and bI>=10 then RadiatorEffects(curVehicle,bE,3000)end;if bI<=9 and bI>=0 then RadiatorEffects(curVehicle,bE,5000)end end;if bh["driveshaft"]<=40 then local bE,bJ=math.random(1,100),bh["driveshaft"]if bJ<=40 and bJ>=25 and bE>85 then DriveShaftEffects(curVehicle,10)end;if bJ<=24 and bJ>=10 and bE>70 then DriveShaftEffects(curVehicle,20)end;if bJ<=9 and bJ>=0 and bE>50 then DriveShaftEffects(curVehicle,30)end end;if bh["transmission"]<=40 then local bE,bK=math.random(1,100),bh["transmission"]if bK<=40 and bK>=25 and bE>85 then TransmissionEffects(curVehicle,5,2)end;if bK<=24 and bK>=10 and bE>70 then TransmissionEffects(curVehicle,10,4)end;if bK<=9 and bK>=0 and bE>50 then TransmissionEffects(curVehicle,20,8)end end;if bh["clutch"]<=40 then local bE,bL=math.random(1,100),bh["clutch"]if bL<=40 and bL>=25 and bE>85 then ClutchEffects(curVehicle,1500,75)end;if bL<=24 and bL>=10 then ClutchEffects(curVehicle,3000,150)end;if bL<=9 and bL>=0 and bE>50 then ClutchEffects(curVehicle,6000,300)end end else return end end,as)else return end end,as)end;function ElectronicsEffects(bM)local bN={"RADIO_03_HIPHOP_NEW","RADIO_04_PUNK","RADIO_05_TALK_01","RADIO_14_DANCE_02","RADIO_20_THELAB","RADIO_17_FUNK","RADIO_18_90S_ROCK"}SetVehicleLights(bM,1)SetVehRadioStation(bM,bN[math.random(1,#bN)])Citizen.Wait(500)SetVehicleLights(bM,0)end;function FuelInjectorEffects(bM,bO)SetVehicleEngineOn(bM,0,0,1)SetVehicleUndriveable(bM,true)Citizen.Wait(bO)SetVehicleEngineOn(bM,1,0,1)SetVehicleUndriveable(bM,false)end;function BrakesEffects(bM,bO)SetVehicleHandbrake(bM,true)Citizen.Wait(bO)SetVehicleHandbrake(bM,false)end;function RadiatorEffects(curVehicle,bE,bO)local bP=GetVehicleEngineTemperature(curVehicle)local bQ=GetVehicleEngineHealth(curVehicle)SetVehicleEngineTemperature(curVehicle,500.0)Citizen.Wait(bO+2000)if bQ>=900 then SetVehicleEngineHealth(curVehicle,bQ-10)end;if bQ>=450 then SetVehicleEngineHealth(curVehicle,bQ-15)end;if bQ>=250 then SetVehicleEngineHealth(curVehicle,bQ-25)end;SetVehicleEngineTemperature(curVehicle,bP)end;function DriveShaftEffects(curVehicle,bO)local bR={-1.0,-0.9,-0.8,0.8,0.9,1.0}local a5=bR[math.random(#bR)]local bS=0;while true do Citizen.Wait(bO)SetVehicleSteerBias(curVehicle,a5)bS=bS+1;if bS>=20 then bS=0;break end end end;function TransmissionEffects(curVehicle,bO,a7)for G=0,a7 do Citizen.Wait(bO)SetVehicleHandbrake(curVehicle,true)Citizen.Wait(1000)SetVehicleHandbrake(curVehicle,false)end end;function ClutchEffects(curVehicle,bO,bT)SetVehicleHandbrake(curVehicle,true)FuelInjectorEffects(curVehicle,bT)for G=1,360 do SetVehicleSteeringScale(curVehicle,G)Citizen.Wait(5)end;Citizen.Wait(bO)SetVehicleHandbrake(curVehicle,false)end;Citizen.CreateThread(function()Citizen.Wait(1000)local lastVehSpeed=0.0;local lastVehBodyhealth=0.0;local bU=2.236936;if Config.UseKMH then bU=3.6 end;while true do Citizen.Wait(1)if curVehicle~=nil and curVehicle~=0 then if driver==PlayerPedId()then local bV=GetVehicleEngineHealth(curVehicle)if bV<0.0 then SetVehicleEngineHealth(curVehicle,0.0)end;local bW=HasEntityCollidedWithAnything(curVehicle)if bW then Citizen.Wait(100)local bX=GetVehicleBodyHealth(curVehicle)local bY=GetEntitySpeed(curVehicle)*bU;if bV>0.0 and lastVehBodyhealth-bX>10 then if bY<lastVehSpeed*0.5 and lastVehSpeed>180.0 then applyCrashDamage(curVehicle)Citizen.Wait(1000)lastVehSpeed=0.0;lastVehBodyhealth=bX end else if bV>10.0 and(bV<199.0 or bX<100.0)then applyCrashDamage(curVehicle)Citizen.Wait(1000)end;lastVehSpeed=bY;lastVehBodyhealth=bX end else lastVehSpeed=GetEntitySpeed(curVehicle)*bU;lastVehBodyhealth=GetVehicleBodyHealth(curVehicle)if bV>10.0 and(bV<199.0 or lastVehBodyhealth<100.0)then applyCrashDamage(curVehicle)Citizen.Wait(1000)end end end end end end)function applyCrashDamage(vehicle)if Config.SlashTires then local bZ={0,1,4,5}for G=1,math.random(#bZ)do local an=math.random(#bZ)SetVehicleTyreBurst(vehicle,bZ[an],true,1000)table.remove(bZ,an)end end;if Config.EngineDisable then SetVehicleEngineHealth(vehicle,0)SetVehicleEngineOn(vehicle,false,true,true)end;local b_={}local c0={}for G=1,Config.AmountPartsDamage do math.randomseed(GetGameTimer())local q=math.random(#Config.HealthParts)if Config.HealthParts[q].degName~="engine"then while b_[q]==q do q=math.random(#Config.HealthParts)if Config.HealthParts[q].degName=="engine"then q=math.random(#Config.HealthParts)end end end;b_[q]=q;local c1=Config.HealthParts[q]local c2=math.random(Config.DegradeValue.min,Config.DegradeValue.max)c0[c1.degName]={label=c1.label,degName=c1.degName,degValue=c2}G=G+1 end;local as=GetVehicleNumberPlateText(curVehicle):gsub("^%s*(.-)%s*$","%1")TriggerServerEvent("t1ger_mechanicjob:degradeVehHealth",as,c0)b_={}c0={}lastVehSpeed=0.0;lastVehBodyhealth=0.0 end;local c3=nil;function ManageNpcJobs()local s={{label="Find Call",value="find_job"},{label="Cancel Job",value="cancel_job"}}local assert=assert;local t=assert(MenuV)local c4=MenuV:CreateMenu("NPC Job Menu","",'size-150')MenuV:OpenMenu(c4,function()end)for h,i in ipairs(s)do local Q=c4:AddButton({icon="ğŸ§‘â€ğŸ”§ 	",label=i.label,value=i,description=i.label,select=function(H)local a5=H.Value.value;if a5=="find_job"then local an=math.random(1,#Config.NPC_RepairJobs)local a7=0;while Config.NPC_RepairJobs[an].inUse and a7<100 do a7=a7+1;an=math.random(1,#Config.NPC_RepairJobs)end;if a7==100 then ShowNotifyESX("Wait for a call")else Config.NPC_RepairJobs[an].inUse=true;Wait(200)TriggerServerEvent('t1ger_mechanicjob:JobDataSV',Config.NPC_RepairJobs)TriggerEvent('t1ger_mechanicjob:startJobWithNPC',an)end elseif a5=="cancel_job"then CancelCurrentJob()OpenMechanicActionMenu()end end})end end;local c5=false;local c6=nil;local c7=nil;RegisterNetEvent("t1ger_mechanicjob:startJobWithNPC")AddEventHandler("t1ger_mechanicjob:startJobWithNPC",function(an)local c8=false;local c9=Config.NPC_RepairJobs[an]local ca=CreateJobBlip(c9.pos)local cb=false;local cc=false;local cd=false;local ce=false;local cf=false;while not c8 and not c5 do Citizen.Wait(0)if c9.inUse then local coords=GetEntityCoords(GetPlayerPed(-1))local f=GetDistanceBetweenCoords(coords.x,coords.y,coords.z,c9.pos[1],c9.pos[2],c9.pos[3],false)if f>50.0 then if DoesEntityExist(c6)then DeleteEntity(c6)DeleteVehicle(c6)SetEntityAsNoLongerNeeded(c6)c6=nil;cb=false end end;if f<50.0 and not cb then ClearAreaOfVehicles(c9.pos[1],c9.pos[2],c9.pos[3],5.0,false,false,false,false,false)cb=true;Citizen.Wait(200)math.randomseed(GetGameTimer())local cg=math.random(#Config.RepairVehicles)local ch=Config.RepairVehicles[cg]RSCore.Functions.SpawnVehicle(ch,function(vehicle)SetEntityCoordsNoOffset(vehicle,c9.pos[1],c9.pos[2],c9.pos[3])SetEntityHeading(vehicle,c9.pos[4])SetVehicleOnGroundProperly(vehicle)SetEntityAsMissionEntity(c6,true,true)c6=vehicle;SetVehicleEngineHealth(c6,100.0)SetVehicleDoorOpen(c6,4,0,0)SetPedIntoVehicle(ped,c6,-1)end,{x=c9.pos[1],y=c9.pos[2],z=c9.pos[3]},true)end;if f<10.0 then if not cd then RequestModel(c9.ped)while not HasModelLoaded(c9.ped)do Wait(10)end;local ci=CreatePedInsideVehicle(c6,1,c9.ped,-1,true,true)NetworkRegisterEntityAsNetworked(ci)SetNetworkIdCanMigrate(NetworkGetNetworkIdFromEntity(ci),true)SetNetworkIdExistsOnAllMachines(NetworkGetNetworkIdFromEntity(ci),true)SetPedKeepTask(ci,true)SetPedDropsWeaponsWhenDead(ci,false)SetEntityInvincible(ci,false)SetEntityVisible(ci,true)c7=ci;SetEntityAsMissionEntity(c7)cd=true end;if not ce and f<6.0 then ShowNotifyESX(Lang["npc_shout_msg"])ce=true end;local aS,aT=GetModelDimensions(GetEntityModel(c6))local aU=GetOffsetFromEntityInWorldCoords(c6,0.0,aT.y+0.2,0.0)local cj=GetEntityCoords(c7)local ck=GetDistanceBetweenCoords(coords,vector3(aU.x,aU.y,aU.z),true)local cl=GetDistanceBetweenCoords(coords,vector3(cj.x,cj.y,cj.z),false)if ck<5.0 and not cc then RSCore.Functions.DrawText3D(aU.x,aU.y,aU.z,Lang["npc_repair_veh"])if IsControlJustPressed(0,38)and ck<1.0 and not cf then cf=true;RSCore.Functions.TriggerCallback("t1ger_mechanicjob:getInventoryItem",function(bm)if bm then SetVehicleDoorOpen(c6,4,0,0)TaskTurnPedToFaceEntity(GetPlayerPed(-1),c6,1.0)Citizen.Wait(1000)local by="mini@repair"LoadAnim(by)if not IsEntityPlayingAnim(GetPlayerPed(-1),by,"fixing_a_player",3)then TaskPlayAnim(GetPlayerPed(-1),by,"fixing_a_player",5.0,-5,-1,16,false,false,false,false)end;RSCore.Functions.Progressbar("sell_pawn_items",4000,Lang["progbar_npc_fix"],false,true,{},{},{},{},function()end,function()end)Citizen.Wait(4000)SetVehicleEngineHealth(c6,1000.0)SetVehicleBodyHealth(c6,1000.0)SetVehicleFixed(c6)for G=0,5 do SetVehicleTyreFixed(c6,G)end;if math.random(100)>10 then TriggerServerEvent("t1ger_mechanicjob:removeItem","repairkit",1)ShowNotifyESX(Lang["npc_kit_broke"])end;SetVehicleDoorShut(vehicle,4,1,1)ClearPedTasks(GetPlayerPed(-1))ShowNotifyESX(Lang["npc_veh_repaired"])cc=true;cf=false else ShowNotifyESX(Lang["npc_need_repair_kit"])cf=false end end,"repairkit")end end;if cl<5.0 and cc then RSCore.Functions.DrawText3D(cj.x,cj.y,cj.z,Lang["npc_collect_cash"])if IsControlJustPressed(0,38)and cl<1.5 then RollDownWindow(c6,0)SetVehicleCanBeUsedByFleeingPeds(c6,true)LoadAnim("mp_common")TaskTurnPedToFaceEntity(PlayerPedId(),c6,1.0)Citizen.Wait(1000)TaskPlayAnim(GetPlayerPed(-1),"mp_common","givetake2_a",4.0,4.0,-1,0,1,0,0,0)RSCore.Functions.Progressbar("sell_pawn_items",4000,Lang["progbar_npc_cash"],false,true,{},{},{},{},function()end,function()end)Citizen.Wait(2000)ClearPedTasks(GetPlayerPed(-1))RollUpWindow(c6,0)ShowNotifyESX(Lang["npc_thanking_msg"])TriggerServerEvent("t1ger_mechanicjob:JobReward")Wait(500)if DoesBlipExist(ca)then RemoveBlip(ca)end;TaskVehicleDriveWander(c7,c6,80.0,786603)Wait(2500)TaskSmartFleePed(c7,PlayerPedId(),40.0,20000)Wait(2500)c5=true end end end;if c5 then if DoesEntityExist(c6)then DeleteVehicle(c6)end;if DoesEntityExist(c7)then DeleteEntity(c7)end;if DoesBlipExist(ca)then RemoveBlip(ca)end;Config.NPC_RepairJobs[an].inUse=false;Wait(200)TriggerServerEvent("t1ger_mechanicjob:JobDataSV",Config.NPC_RepairJobs)c6=nil;c7=nil;c5=false;break end end end end)function CreateJobBlip(g)local ca=AddBlipForCoord(g[1],g[2],g[3])SetBlipSprite(ca,1)SetBlipColour(ca,5)AddTextEntry("MYBLIP",Lang["npc_repair_job"])BeginTextCommandSetBlipName("MYBLIP")AddTextComponentSubstringPlayerName(name)EndTextCommandSetBlipName(ca)SetBlipScale(ca,0.7)SetBlipAsShortRange(ca,true)SetBlipRoute(ca,true)SetBlipRouteColour(ca,5)return ca end;AddEventHandler("esx:onPlayerDeath",function(K)c5=true;if c6~=nil or c7~=nil then ShowNotifyESX(Lang["npc_cancel_job_death"])end;Wait(300)c5=false end)function CancelCurrentJob()c5=true;if c6~=nil or c7~=nil then ShowNotifyESX(Lang["npc_job_cancel_by_ply"])end;Wait(300)c5=false end;RegisterNetEvent("t1ger_mechanicjob:liftStateCL")AddEventHandler("t1ger_mechanicjob:liftStateCL",function(h,q,r,vehicle,cm)Config.MechanicShops[h].lifts[q]=r;Config.MechanicShops[h].lifts[q].currentVeh=vehicle;Config.MechanicShops[h].lifts[q].inUse=cm end)RegisterNetEvent("t1ger_mechanicjob:syncVehicleBodyCL")AddEventHandler("t1ger_mechanicjob:syncVehicleBodyCL",function(as)RefreshVehicleDamage(vehicleData[as].entity,as)end)function GetBodyRepairProgression(cn)if DoesEntityExist(cn)then local co=GetVehicleNumberOfWheels(cn)local cp=GetNumberOfVehicleDoors(cn)-2;local as=GetVehicleNumberPlateText(cn):gsub("^%s*(.-)%s*$","%1")local cq,cr=0,0;local cs=cp+co+cq+cr+2;co,cp=0,0;for G=0,GetNumberOfVehicleDoors(cn)-2-1 do if vehicleData[as].report.doors[G+1]==false then cp=cp+1 end end;if vehicleData[as].report.doors[5]==false then cq=cq+1 end;if vehicleData[as].report.doors[6]==false then cr=cr+1 end;for G=0,GetVehicleNumberOfWheels(cn)-1 do if vehicleData[as].report.wheels[G+1]==false then co=co+1 end end;local b1=co+cp+cq+cr;return math.floor(b1/cs*100)end end;function SpawnJackProp(vehicle)local ct=GetEntityHeading(vehicle)local bn=GetEntityCoords(vehicle)carJackObj=CreateObject(GetHashKey("prop_carjack"),bn.x,bn.y,bn.z-0.95,true,true,true)SetEntityHeading(carJackObj,ct)FreezeEntityPosition(carJackObj,true)end;function GetControlOfEntity(bM)local bv=15;NetworkRequestControlOfEntity(bM)while not NetworkHasControlOfEntity(bM)and bv>0 do NetworkRequestControlOfEntity(bM)Citizen.Wait(100)bv=bv-1 end end;RegisterNetEvent("t1ger_mechanicjob:JobDataCL")AddEventHandler("t1ger_mechanicjob:JobDataCL",function(K)Config.NPC_RepairJobs=K end)AddEventHandler("onClientResourceStart",function(cu)local ped=GetPlayerPed(-1)local coords=GetEntityCoords(ped)TriggerServerEvent("t1ger_mechanicjob:fetchMechShops")vehicle=GetClosestVehicle(coords.x,coords.y,coords.z,5.0,0,71)if vehicle then FreezeEntityPosition(vehicle,false)else return end;ClearPedSecondaryTask(player)Wait(500)local aj=GetHashKey("prop_carjack")local bl=GetClosestObjectOfType(coords.x,coords.y,coords.z,1.0,aj,false,false,false)if bl then if DoesEntityExist(aj)then print(true)DeleteEntity(aj)DeleteObject(aj)end end end)SpawnObject=function(cv,coords,cw,cx,cy)local cz=type(coords)=="vector3"and coords or vec(coords.x,coords.y,coords.z)cx=cx==nil and true or false;cy=cy~=nil and true or false;CreateThread(function()cv=type(cv)=='number'and cv or GetHashKey(cv)local a=CreateObject(cv,cz.xyz,cx,false,cy)if cw then cw(a)end end)end 
 -- JERICOFX#3512
 -- JERICOFX#3512
 -- JERICOFX#3512
 -- JERICOFX#3512
 -- JERICOFX#3512
 -- JERICOFX#3512
 -- JERICOFX#3512
 -- JERICOFX#3512
 -- JERICOFX#3512
